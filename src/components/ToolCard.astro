---
import type { Tool } from '../data/tools';

interface Props {
  tool: Tool;
  compact?: boolean;
}

const { tool, compact = false } = Astro.props;

const formatStars = (stars?: number) => {
  if (!stars) return null;
  if (stars >= 1000) {
    return `${(stars / 1000).toFixed(1)}k`;
  }
  return stars.toString();
};

const licenseColors = {
  'open-source': 'badge-opensource',
  'commercial': 'badge-commercial',
  'hybrid': 'badge-byoc',
};
---

<a
  href={`/tools/${tool.id}`}
  class:list={[
    "card group block",
    compact ? "p-4" : "p-6",
  ]}
>
  <div class="flex items-start justify-between gap-4 mb-3">
    <div class="flex-1 min-w-0">
      <h3 class:list={[
        "font-semibold text-[var(--color-text-primary)] group-hover:text-[var(--color-accent-600)] transition-colors",
        compact ? "text-base" : "text-lg",
      ]}>
        {tool.name}
      </h3>
    </div>
    <span class:list={["badge shrink-0", licenseColors[tool.license]]}>
      {tool.license === 'open-source' ? 'OSS' : tool.license === 'commercial' ? 'Commercial' : 'Hybrid'}
    </span>
  </div>

  <p class:list={[
    "text-[var(--color-text-secondary)] mb-4",
    compact ? "text-sm line-clamp-2" : "text-sm",
  ]}>
    {tool.description}
  </p>

  <div class="flex flex-wrap items-center gap-2 mb-4">
    {tool.tags.slice(0, compact ? 3 : 5).map((tag) => (
      <span class="text-xs px-2 py-1 rounded-md bg-[var(--color-slate-100)] text-[var(--color-text-secondary)]">
        {tag}
      </span>
    ))}
    {tool.tags.length > (compact ? 3 : 5) && (
      <span class="text-xs text-[var(--color-text-muted)]">
        +{tool.tags.length - (compact ? 3 : 5)}
      </span>
    )}
  </div>

  <div class="flex items-center gap-4 text-xs text-[var(--color-text-muted)]">
    {tool.github && tool.stars && (
      <span class="flex items-center gap-1">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 .25a.75.75 0 0 1 .673.418l3.058 6.197 6.839.994a.75.75 0 0 1 .415 1.279l-4.948 4.823 1.168 6.811a.751.751 0 0 1-1.088.791L12 18.347l-6.117 3.216a.75.75 0 0 1-1.088-.79l1.168-6.812-4.948-4.823a.75.75 0 0 1 .416-1.28l6.838-.993L11.327.668A.75.75 0 0 1 12 .25Z"/>
        </svg>
        {formatStars(tool.stars)}
      </span>
    )}
    {tool.language && (
      <span class="flex items-center gap-1">
        <span class="w-2 h-2 rounded-full bg-[var(--color-accent-500)]"></span>
        {tool.language}
      </span>
    )}
    {tool.cloudSupport.includes('any') ? (
      <span>Any cloud</span>
    ) : (
      <span>{tool.cloudSupport.join(', ').toUpperCase()}</span>
    )}
  </div>
</a>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
