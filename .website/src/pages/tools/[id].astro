---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getTools, categories, getToolsByCategory, type Tool } from '../../data/tools';

export async function getStaticPaths() {
  const tools = await getTools();
  return tools.map((tool) => ({
    params: { id: tool.id },
    props: { tool },
  }));
}

const { tool } = Astro.props as { tool: Tool };
const categoryInfo = categories[tool.category];
const allRelatedTools = await getToolsByCategory(tool.category);
const relatedTools = allRelatedTools
  .filter((t) => t.id !== tool.id)
  .slice(0, 3);

const formatStars = (stars?: number) => {
  if (!stars) return null;
  if (stars >= 1000) {
    return `${(stars / 1000).toFixed(1)}k`;
  }
  return stars.toString();
};

const licenseLabels = {
  'open-source': 'Open Source',
  'commercial': 'Commercial',
  'hybrid': 'Hybrid (Open Core)',
};
---

<Layout title={tool.name} description={tool.description}>
  <Header />

  <main class="flex-1">
    <div class="container py-12 md:py-16">
      <!-- Breadcrumb -->
      <nav class="mb-8">
        <ol class="flex items-center gap-2 text-body text-[var(--color-text-muted)]">
          <li><a href="/" class="hover:text-[var(--color-text-primary)] transition-colors">Home</a></li>
          <li>/</li>
          <li><a href="/#tools" class="hover:text-[var(--color-text-primary)] transition-colors">Tools</a></li>
          <li>/</li>
          <li class="text-[var(--color-text-secondary)]">{tool.name}</li>
        </ol>
      </nav>

      <!-- Header -->
      <div class="mb-8">
        <h1 class="h1 font-mono text-[var(--color-text-primary)] mb-4">
          {tool.name}
        </h1>
        <p class="text-base-large text-[var(--color-text-secondary)] leading-relaxed">
          {tool.description}
        </p>
      </div>

      <!-- Benefits Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12 pb-8 border-b border-[var(--color-border)]">
        <div>
          <i class="ph-bold ph-shield-check text-3xl mb-3" style="color: #0070F3;"></i>
          <h3 class="text-body font-semibold text-[var(--color-text-primary)] mb-2">Data Sovereignty</h3>
          <p class="text-subtext text-[var(--color-text-secondary)]">Data never leaves your cloud account</p>
        </div>
        <div>
          <i class="ph-bold ph-lock-open text-3xl mb-3" style="color: #7928CA;"></i>
          <h3 class="text-body font-semibold text-[var(--color-text-primary)] mb-2">No Vendor Lock-in</h3>
          <p class="text-subtext text-[var(--color-text-secondary)]">Control your infrastructure completely</p>
        </div>
        <div>
          <i class="ph-bold ph-receipt text-3xl mb-3" style="color: #FF0080;"></i>
          <h3 class="text-body font-semibold text-[var(--color-text-primary)] mb-2">Cost Transparency</h3>
          <p class="text-subtext text-[var(--color-text-secondary)]">See all costs on your cloud bill</p>
        </div>
        <div>
          <i class="ph-bold ph-shield-star text-3xl mb-3" style="color: #50E3C2;"></i>
          <h3 class="text-body font-semibold text-[var(--color-text-primary)] mb-2">Security Control</h3>
          <p class="text-subtext text-[var(--color-text-secondary)]">Apply your own security policies</p>
        </div>
      </div>

      {tool.longDescription && (
        <div class="mb-8 p-6 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded-[12px]">
          <h2 class="text-label text-[var(--color-text-muted)] mb-3">ABOUT</h2>
          <p class="text-body text-[var(--color-text-secondary)] leading-relaxed">
            {tool.longDescription}
          </p>
        </div>
      )}

      <div class="mb-8">
        <h2 class="text-label text-[var(--color-text-muted)] mb-4">TAGS</h2>
        <div class="flex flex-wrap gap-2">
          {tool.tags.map((tag) => (
            <span class="badge badge-oss">{tag}</span>
          ))}
        </div>
      </div>

      <div class="mb-8">
        <h2 class="text-label text-[var(--color-text-muted)] mb-4">CLOUD SUPPORT</h2>
        <div class="flex flex-wrap gap-2">
          {tool.cloudSupport.map((cloud) => (
            <span class="badge badge-oss">
              {cloud === 'any' ? 'Any Cloud' : cloud.toUpperCase()}
            </span>
          ))}
        </div>
      </div>

      <div class="flex flex-wrap gap-3">
        <a
          href={tool.homepage}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-6 py-3 bg-[var(--color-text-primary)] text-[var(--color-bg-primary)] border border-[var(--color-text-primary)] rounded-[10px] font-medium text-[14px] hover:opacity-90 transition-all"
        >
          <i class="ph-bold ph-arrow-square-out"></i>
          Website
        </a>
        {tool.github && (
          <a
            href={tool.github}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-6 py-3 bg-transparent text-[var(--color-text-primary)] border border-[var(--color-border)] rounded-[10px] font-medium text-[14px] hover:border-[var(--color-text-primary)] transition-all"
          >
            <i class="ph-bold ph-github-logo"></i>
            GitHub
          </a>
        )}
        {tool.docs && (
          <a
            href={tool.docs}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-6 py-3 bg-transparent text-[var(--color-text-primary)] border border-[var(--color-border)] rounded-[10px] font-medium text-[14px] hover:border-[var(--color-text-primary)] transition-all"
          >
            <i class="ph-bold ph-book-open"></i>
            Docs
          </a>
        )}
      </div>
    </div>
  </main>

  <Footer />
</Layout>

